<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Public)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">üìã ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞)</h1>
      <a href="./admin-report-enhanced.html" class="text-blue-600 hover:underline">‡πÄ‡∏Ç‡πâ‡∏≤ ‚Äú‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‚Äù</a>
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
    <form id="customerForm" class="bg-white p-5 rounded-xl shadow mb-8 grid md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm text-gray-600 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
        <input id="date" type="date" class="w-full border rounded-lg px-3 py-2" required />
      </div>
      <div>
        <label class="block text-sm text-gray-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠</label>
        <input id="name" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" class="w-full border rounded-lg px-3 py-2" required />
      </div>
      <div>
        <label class="block text-sm text-gray-600 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
        <input id="phone" type="tel" placeholder="08X-XXX-XXXX" class="w-full border rounded-lg px-3 py-2" required />
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block text-sm text-gray-600 mb-1">‡πÄ‡∏û‡∏®</label>
          <select id="gender" class="w-full border rounded-lg px-3 py-2" required>
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option>‡∏ä‡∏≤‡∏¢</option><option>‡∏´‡∏ç‡∏¥‡∏á</option>
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-600 mb-1">‡∏≠‡∏≤‡∏¢‡∏∏</label>
          <input id="age" type="number" min="1" max="120" class="w-full border rounded-lg px-3 py-2" required />
        </div>
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm text-gray-600 mb-1">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
        <input id="disease" type="text" placeholder="‡∏ñ‡πâ‡∏≤‡∏°‡∏µ" class="w-full border rounded-lg px-3 py-2" />
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm text-gray-600 mb-1">‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏û‡∏¥‡πÄ‡∏®‡∏©</label>
        <textarea id="specialCare" rows="2" class="w-full border rounded-lg px-3 py-2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÅ‡∏û‡πâ‡∏¢‡∏≤ ‡∏Ø‡∏•‡∏Ø"></textarea>
      </div>
      <div>
        <label class="block text-sm text-gray-600 mb-1">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à</label>
        <select id="roomType" class="w-full border rounded-lg px-3 py-2" required>
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
          <option>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß</option>
          <option>‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏ä‡∏≤‡∏¢</option>
          <option>‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏´‡∏ç‡∏¥‡∏á</option>
          <option>‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏° 2 ‡∏ó‡πà‡∏≤‡∏ô</option>
          <option>‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏° 3 ‡∏ó‡πà‡∏≤‡∏ô</option>
          <option>‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏° 5 ‡∏ó‡πà‡∏≤‡∏ô</option>
          <option>‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©</option>
        </select>
      </div>
      <div>
        <label class="block text-sm text-gray-600 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠ (‡∏ö‡∏≤‡∏ó)</label>
        <input id="price" type="number" min="0" class="w-full border rounded-lg px-3 py-2" required />
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm text-gray-600 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
        <select id="decision" class="w-full border rounded-lg px-3 py-2" required>
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
          <option>‡πÉ‡∏´‡∏°‡πà</option>
          <option>‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</option>
          <option>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</option>
          <option>‡∏£‡∏≠‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à</option>
          <option>‡∏£‡∏≠‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
          <option>‡∏£‡∏≠‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</option>
          <option>‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏≠‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à</option>
          <option>‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>
          <option>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</option>
        </select>
      </div>
      <div class="md:col-span-2">
        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg py-3">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button>
      </div>
    </form>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
    <div class="bg-white rounded-xl shadow p-5">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
        <span class="text-sm text-gray-600">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b id="total">0</b> ‡∏Ñ‡∏ô</span>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="bg-gray-100">
              <th class="p-2 text-left">#</th>
              <th class="p-2 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th class="p-2 text-left">‡∏ä‡∏∑‡πà‡∏≠</th>
              <th class="p-2 text-left">‡πÄ‡∏ö‡∏≠‡∏£‡πå</th>
              <th class="p-2 text-left">‡πÄ‡∏û‡∏®/‡∏≠‡∏≤‡∏¢‡∏∏</th>
              <th class="p-2 text-left">‡∏´‡πâ‡∏≠‡∏á</th>
              <th class="p-2 text-left">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
              <th class="p-2 text-left">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            </tr>
          </thead>
          <tbody id="list"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
    import { firebaseConfig } from "./firebaseConfig.js";

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const colRef = collection(db, "customers");
    const q = query(colRef, orderBy("createdAt", "desc"));

    const fmtTH = (dStr) => {
      const d = new Date(dStr);
      return isNaN(d) ? "-" : d.toLocaleDateString('th-TH', { year:'numeric', month:'short', day:'numeric' });
    };
    const fmtNum = (n) => new Intl.NumberFormat('th-TH').format(n || 0);

    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    onSnapshot(q, (snap) => {
      const tbody = document.getElementById("list");
      const total = document.getElementById("total");
      let i = 1, rows = "";
      snap.forEach(doc => {
        const c = doc.data();
        rows += `<tr class="border-t">
          <td class="p-2">${i++}</td>
          <td class="p-2">${fmtTH(c.date)}</td>
          <td class="p-2 font-medium">${c.name}</td>
          <td class="p-2">${c.phone}</td>
          <td class="p-2">${c.gender} / ${c.age} ‡∏õ‡∏µ</td>
          <td class="p-2">${c.roomType}</td>
          <td class="p-2">‡∏ø${fmtNum(c.price)}</td>
          <td class="p-2">${c.decision}</td>
        </tr>`;
      });
      tbody.innerHTML = rows || `<tr><td colspan="8" class="p-4 text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
      total.textContent = snap.size;
    });

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const form = document.getElementById("customerForm");
    const dateEl = document.getElementById("date");
    dateEl.valueAsDate = new Date();

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const payload = {
        date: document.getElementById("date").value,
        name: document.getElementById("name").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        gender: document.getElementById("gender").value,
        age: Number(document.getElementById("age").value || 0),
        disease: document.getElementById("disease").value || "",
        specialCare: document.getElementById("specialCare").value || "",
        roomType: document.getElementById("roomType").value,
        price: Number(document.getElementById("price").value || 0),
        decision: document.getElementById("decision").value,
        createdAt: serverTimestamp(),
      };
      await addDoc(colRef, payload);
      form.reset();
      dateEl.valueAsDate = new Date();
    });
  </script>
</body>
</html>
